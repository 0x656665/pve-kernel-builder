name: Build kernel on new version

on:
  workflow_dispatch:
  push:
    branches:
      - 'main'
    paths:
      - 'config/**/version'

env:
  DEBIAN_FRONTEND: noninteractive

jobs:
  build:
    name: Build new kernel
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Sources
        uses: actions/checkout@main

      - name: Extract branch affected
        run: |
          event="${{ toJSON(github.event) }}"
          for commit in `echo $event | yq '.event.commits[] as $c | $c.id'`; do
              echo "Commit: $commit"
              affected_files=$(git log --format= --name-status -n 1 $c | cut -f 2)
              for file in $affected_files; do
                  echo "analyzing $file"
                  if [[ $file = "config/*" ]]; then
                      echo "$file is a config file"
                  fi
              done
          done

#      - name: Run build kernel workflow
#        uses: ./.github/workflows/build-pve-kernel-container.yml
#        with:
#          branch: ${{ github.event.branch}

